---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ResourceCard from '../../components/ResourceCard.astro';
import CollectionView from '../../components/CollectionView.astro';
import type { ColumnDef, FilterDef } from '../../lib/collection-view';
import { getCollection } from 'astro:content';

const resources = await getCollection('resources');
const sorted = resources.sort((a, b) => a.data.name.localeCompare(b.data.name));

const categoryOptions = Array.from(
  new Set(sorted.map((resource) => resource.data.category).filter(Boolean))
).sort() as string[];
const statusOptions = Array.from(
  new Set(sorted.map((resource) => resource.data.status).filter(Boolean))
).sort() as string[];

const columns: ColumnDef[] = [
  { key: 'name', label: 'Name', sortable: true, primary: true, type: 'text' },
  { key: 'category', label: 'Category', sortable: true, type: 'text' },
  { key: 'status', label: 'Status', sortable: true, type: 'badge' },
];

const filters: FilterDef[] = [
  { key: 'category', label: 'Category', options: categoryOptions },
  { key: 'status', label: 'Status', options: statusOptions },
];
---

<BaseLayout title="Resources â€” CustDev Wiki">
  <h1>Resources</h1>
  <p class="subtitle">Tools, services, and platforms powering the team.</p>

  <CollectionView
    items={sorted}
    columns={columns}
    filters={filters}
    basePath="/resources"
    emptyMessage="No resources yet."
  >
    {sorted.map((resource) => (
      <div data-cv-id={resource.id}>
        <ResourceCard
          name={resource.data.name}
          slug={resource.id}
          category={resource.data.category}
          status={resource.data.status}
          url={resource.data.url}
        />
      </div>
    ))}
  </CollectionView>
</BaseLayout>

<style>
  .subtitle {
    color: var(--color-text-muted);
    margin-bottom: 2rem;
  }
</style>
